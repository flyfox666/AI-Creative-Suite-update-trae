## 问题

* 模型未严格遵循场景数量（返回 21 个场景）

* 语言未按用户提示词一致（中文提示词希望中文输出，英文提示词希望英文输出）

## 方案

1. 在分镜生成的系统提示中明确约束：

* 精确输出场景数量：只允许 “Scene 1..N” 或 “场景 1..N”，不允许多余的场景

* 语言一致：如果用户提示词含中文字符，则输出中文标题与中文内容；否则输出英文标题与英文内容

* 键名与结构保持解析器可识别：我们已增强解析器支持中英文键名与标题

1. 语言检测与提示动态化：

* 在 `services/providers/arkProvider.ts` 中根据用户输入是否包含中文字符，选择标题样式（Scene/场景）与语言提示

1. 后处理裁剪：

* 解析后若场景数 > 设定值，按设定值裁剪

* 若场景数 < 设定值，保留已有场景并提示不足（不阻塞流程）

* 重新计算 `copyReadyPrompt` 仅包含裁剪后的场景

1. 可选参数：

* `max_tokens` 适度限制过长输出

* `temperature=0`（若需要更严格，可后续加入）

## 涉及文件

* `services/providers/arkProvider.ts`：检测语言、更新系统提示、解析后裁剪并重算 `copyReadyPrompt`

## 验证

* 设置总时长 15 秒、场景数 3；无论中文或英文提示词，输出严格 3 个场景，内容语言随提示词一致；生图正常。

