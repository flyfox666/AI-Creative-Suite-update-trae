## 目标
- 在本地终端实时查看 Gemini/Ark 调用的请求与响应日志（含上传、分析、生成）。
- 保留现有前端结构，不改生产部署，仅用于开发排查。

## 技术方案
- 新增本地日志代理（Node + fetch）：
  - 监听 `http://localhost:4000`。
  - 路由：
    - `/gemini/*` → 代理到 `https://generativelanguage.googleapis.com/*`
    - `/ark/*` → 代理到 `https://ark.cn-beijing.volces.com/*`
  - 日志内容：方法、路径、查询、请求体大小、响应状态与时间、响应体摘要；自动脱敏（移除/掩码 `x-goog-api-key`、`Authorization`）。
  - 可选：把日志同步写入 `logs/dev.log`，并提供 SSE `/logs/stream` 供浏览器查看。
- 前端接入：
  - 开发模式下将 Gemini Base URL 改为 `http://localhost:4000/gemini`（Ark 可改为 `http://localhost:4000/ark` 或保持当前 `/arkapi`）。
  - 不改生产 `.env`；仅在 Settings 页或 `process.env` 开发配置生效。
- 启动命令：
  - 新增 `npm run proxy` 启动日志代理。
  - 单独启动：终端 1 运行 `npm run proxy`；终端 2 运行 `npm run dev`。

## 实现步骤
1) 新建 `scripts/gemini-proxy.mjs`
- 基于 Node 原生 `http` 或 `express`（无依赖优先）实现反向代理；统一 fetch 目标；打印日志到控制台与文件。
- 统一添加/透传必要头；对 `upload/v1beta/files` 的可恢复上传与 `models/*:generateContent` 等端点无特殊改写，仅透明代理。

2) 日志格式与脱敏
- 示例：`[2025-11-16T09:50:12.345Z] POST /gemini/v1beta/models/gemini-2.5-flash:generateContent 200 (512ms) req=18KB res=3.2KB`
- 打印最多 1KB 的响应片段；其余用 `…`；头部对密钥做 `****` 掩码。

3) 前端指向代理
- 开发时在 Settings 页把 `Gemini Base URL` 改为 `http://localhost:4000/gemini`；Ark 如需也指向 `http://localhost:4000/ark`。
- 保留原生端点在非开发场景。

4) 可选 SSE 浏览器日志页
- 代理提供 `/logs/stream` 以 SSE 推送日志；可在前端加一个简易页面订阅显示（非必需）。

## 验证
- 终端启动代理与前端后，执行文件上传与视频/图片分析；观察终端日志中请求/响应细节，定位错误原因（如状态非 `ACTIVE`、请求体结构错误、鉴权失败等）。

确认后我将添加日志代理脚本与 npm script，并指导你将 Settings 指向代理，随后联调。